{% extends 'base.html' %}
{% load static %}
{% block content %}
<!-- Custom CSS Animations -->
<style>
    @keyframes spin {
        from {
            transform: rotate(0deg);
        }

        to {
            transform: rotate(360deg);
        }
    }

    .animate-spin-slow {
        animation: spin 20s linear infinite;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    .animate-fade-in {
        animation: fadeIn 1s ease-in-out;
    }

    @keyframes slideIn {
        from {
            transform: translateY(-20px);
            opacity: 0;
        }

        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .animate-slide-in {
        animation: slideIn 1s ease-out;
    }

    @keyframes bounceIn {
        0% {
            transform: scale(0.5);
            opacity: 0;
        }

        60% {
            transform: scale(1.05);
            opacity: 1;
        }

        100% {
            transform: scale(1);
        }
    }

    .animate-bounce-in {
        animation: bounceIn 0.8s ease-out;
    }
</style>

<section id="start-investing" class="bg-gray-50 py-24">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Page Heading -->
        <div class="text-center mb-12">
            <h2
                class="text-4xl md:text-5xl font-bold text-gray-900 mb-6 animate__animated animate__fadeIn bg-clip-text text-transparent bg-gradient-to-r from-[#4C1D95] via-[#9D174D] to-[#4C1D95]">
                Discover opportunities. Follow our process. Build global wealth
            </h2>



        </div>

        <!-- Three-Column Layout -->
        <div class="flex flex-col md:flex-row gap-8">
            <!-- Left Column: Globe -->
            <div class="w-full md:w-1/3 flex items-center justify-center">
                <div class="relative animate__animated animate__fadeInRight">
                    <div class="relative z-10 bg-white rounded-2xl p-8 border border-gray-200 shadow-xl">
                        <div class="space-y-6">
                            <div
                                class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-all cursor-pointer">
                                <div>
                                    <h3 class="text-gray-900 font-semibold">AI Risk Analysis</h3>
                                    <p class="text-gray-600">Real-time market insights</p>
                                </div>
                                <div
                                    class="h-12 w-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                    </svg>
                                </div>
                            </div>

                            <div
                                class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-all cursor-pointer">
                                <div>
                                    <h3 class="text-gray-900 font-semibold">Portfolio Analytics</h3>
                                    <p class="text-gray-600">Performance tracking</p>
                                </div>
                                <div
                                    class="h-12 w-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                                        </path>
                                    </svg>
                                </div>
                            </div>

                            <div
                                class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-all cursor-pointer">
                                <div>
                                    <h3 class="text-gray-900 font-semibold">Secure Transactions</h3>
                                    <p class="text-gray-600">Enterprise-grade security</p>
                                </div>
                                <div
                                    class="h-12 w-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                                        </path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Globe Canvas Container -->
                <div id="globe-canvas" class="w-full h-full" style="min-height: 300px;"></div>
            </div>
            <!-- Right Column: Investment Inquiry Form -->
            <div class="w-full md:w-1/3">
                <div class="bg-white shadow-lg rounded-lg p-6 animate-bounce-in">
                    <h2 class="text-3xl font-bold text-gray-800 text-center mb-6 animate-fade-in">Investment Inquiry
                    </h2>
                    <form id="investingForm" action="{% url 'start_investing' %}" method="POST" class="space-y-6"
                        novalidate>
                        {% csrf_token %}
                        <div>
                            <label for="name" class="block text-lg font-medium text-gray-700">Your Name</label>
                            <input type="text" id="name" name="name" required
                                class="mt-2 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label for="email" class="block text-lg font-medium text-gray-700">Email</label>
                            <input type="email" id="email" name="email" required
                                class="mt-2 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label for="phone" class="block text-lg font-medium text-gray-700">Phone Number</label>
                            <input type="tel" id="phone" name="phone" placeholder="Optional"
                                title="Please enter a valid phone number (numbers, spaces, dashes, parentheses, and optional leading +)"
                                class="mt-2 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label for="investment_amount" class="block text-lg font-medium text-gray-700">Investment
                                Amount ($)</label>
                            <input type="number" id="investment_amount" name="investment_amount" required
                                class="mt-2 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label for="investment_goal" class="block text-lg font-medium text-gray-700">Investment
                                Goal</label>
                            <select id="investment_goal" name="investment_goal" required
                                class="mt-2 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Select a goal</option>
                                <option value="retirement">Retirement Planning</option>
                                <option value="wealth">Wealth Building</option>
                                <option value="education">Education Fund</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div>
                            <label for="risk_tolerance" class="block text-lg font-medium text-gray-700">Risk
                                Tolerance</label>
                            <select id="risk_tolerance" name="risk_tolerance" required
                                class="mt-2 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Select your risk tolerance</option>
                                <option value="low">Low Risk</option>
                                <option value="medium">Medium Risk</option>
                                <option value="high">High Risk</option>
                            </select>
                        </div>
                        <div>
                            <label for="sectors" class="block text-lg font-medium text-gray-700">Preferred
                                Sectors</label>
                            <input type="text" id="sectors" name="sectors" placeholder="e.g. Technology, Healthcare"
                                class="mt-2 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <button type="submit"
                            class="w-full py-3 px-6 bg-blue-700 hover:bg-blue-600 text-white font-semibold rounded-lg shadow transition duration-300 transform hover:scale-105">
                            Get Started
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Three.js Globe Script -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        if (typeof THREE === 'undefined') {
            console.error("Three.js is not loaded. Please check your CDN link.");
            return;
        }
        const container = document.getElementById('globe-canvas');
        if (!container) return;
        // Set container dimensions to fill viewport height
        container.style.width = '100vw';
        container.style.height = '100vh';
        const width = container.clientWidth;
        const height = container.clientHeight;
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(width, height);
        container.appendChild(renderer.domElement);
        const geometry = new THREE.SphereGeometry(5, 64, 64);
        const textureLoader = new THREE.TextureLoader();
        const earthTexture = textureLoader.load('https://threejs.org/examples/textures/earth_atmos_2048.jpg');
        const material = new THREE.MeshPhongMaterial({ map: earthTexture });
        const sphere = new THREE.Mesh(geometry, material);
        scene.add(sphere);
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
        directionalLight.position.set(5, 5, 5);
        scene.add(directionalLight);
        camera.position.z = 10;
        window.addEventListener('resize', function () {
            const newWidth = container.clientWidth;
            const newHeight = container.clientHeight;
            renderer.setSize(newWidth, newHeight);
            camera.aspect = newWidth / newHeight;
            camera.updateProjectionMatrix();
        });
        function animate() {
            requestAnimationFrame(animate);
            sphere.rotation.y += 0.005;
            renderer.render(scene, camera);
        }
        animate();
    });
</script>

<!-- AJAX Submission for Investing Form -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const investingForm = document.getElementById('investingForm');
        if (investingForm) {
            investingForm.addEventListener('submit', function (event) {
                event.preventDefault();
                const phoneInput = document.getElementById('phone');
                if (phoneInput && phoneInput.value) {
                    const pattern = /^\+?[0-9\s\-()]+$/;
                    if (!pattern.test(phoneInput.value)) {
                        phoneInput.setCustomValidity("Please enter a valid phone number (numbers, spaces, dashes, parentheses, and an optional leading +).");
                        phoneInput.reportValidity();
                        return;
                    } else {
                        phoneInput.setCustomValidity("");
                    }
                }
                const formData = new FormData(investingForm);
                fetch(investingForm.action, {
                    method: 'POST',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: formData
                })
                    .then(response => {
                        if (!response.ok) {
                            return response.json().then(data => { throw data; });
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.status === "success") {
                            showPopup(data.message, false);
                            investingForm.reset();
                        } else {
                            showPopup(data.message, true);
                        }
                    })
                    .catch(errorData => {
                        const errorMsg = errorData.message || "An error occurred. Please try again later.";
                        showPopup(errorMsg, true);
                    });
            });
        }
        function showPopup(message, isError = false) {
            const popup = document.createElement('div');
            popup.id = 'popup-message';
            popup.className = 'fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50';
            popup.innerHTML = `
            <div class="bg-white p-8 rounded shadow-lg max-w-md mx-auto">
                <p class="text-xl font-semibold ${isError ? 'text-red-700' : 'text-green-700'}">${message}</p>
                <button id="close-popup" class="mt-4 px-4 py-2 bg-blue-700 text-white rounded hover:bg-blue-600">Close</button>
            </div>
        `;
            document.body.appendChild(popup);
            document.getElementById('close-popup').addEventListener('click', function () {
                document.body.removeChild(popup);
            });
            setTimeout(function () {
                if (document.body.contains(popup)) {
                    document.body.removeChild(popup);
                }
            }, 5000);
        }
    });
</script>
{% endblock %}